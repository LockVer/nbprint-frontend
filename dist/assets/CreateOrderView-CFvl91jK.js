var We=Object.defineProperty;var qe=(o,e,t)=>e in o?We(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Ce=(o,e,t)=>qe(o,typeof e!="symbol"?e+"":e,t);import{X,a as we}from"./XComponent-gqGWi3a1.js";import{_ as ce,h as j,a as He,i as ie,j as J,c as U,k as se,l as x,e as S,m as r,n as ge,r as C,d as N,q as be,s as ae,F as re,E as le,p as Ve,f as De,t as Ae,x as he,y as Ge,z as me,g as K,o as ye,A as Ye,B as Fe,C as Ne,D as je,w as Ke,G as _e,H as Je,I as Ze,u as et,J as tt,K as lt}from"./index-D_kmQFyZ.js";import{X as pe,L as at}from"./LayoutFooter-wWzKYPlc.js";import{l as Pe}from"./lodash-C7Pouijc.js";import{O as ot}from"./OpenCardService-DI5upRg8.js";const nt={class:"general-content"},it={__name:"General",props:{initData:{},initDataModifiers:{}},emits:["update:initData"],setup(o){const e=j(o,"initData"),t=He();return e.value.sales.employeeName=t.state.userInfo.userName,e.value.sales.employeeId=t.state.userInfo.id,console.log(t.state.userInfo),ie(()=>t.state.userInfo,l=>{e.value.sales.employeeName=l.userName,e.value.sales.employeeId=l.id,console.log(l)}),(l,a)=>{const v=J("el-input"),n=J("el-option"),m=J("el-select");return U(),se(we,{title:"通用信息"},{default:x(()=>[S("div",nt,[r(X,{label:"名字",width:"220px"},{default:x(()=>[r(v,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=h=>e.value.name=h),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),r(X,{label:"译名",width:"220px"},{default:x(()=>[r(v,{modelValue:e.value.translatedName,"onUpdate:modelValue":a[1]||(a[1]=h=>e.value.translatedName=h),placeholder:"请输入译名"},null,8,["modelValue"])]),_:1}),r(X,{label:"客户名字",width:"220px"},{default:x(()=>[r(v,{modelValue:e.value.client.clientName,"onUpdate:modelValue":a[2]||(a[2]=h=>e.value.client.clientName=h),placeholder:"请输入客户名字"},null,8,["modelValue"])]),_:1}),r(X,{label:"业务员",width:"220px"},{default:x(()=>[r(v,{modelValue:e.value.sales.employeeName,"onUpdate:modelValue":a[3]||(a[3]=h=>e.value.sales.employeeName=h),disabled:"",placeholder:"请输入业务员"},null,8,["modelValue"])]),_:1}),r(X,{label:"货币符号",width:"220px"},{default:x(()=>[r(m,{modelValue:e.value.currency,"onUpdate:modelValue":a[4]||(a[4]=h=>e.value.currency=h),placeholder:"请选择货币符号"},{default:x(()=>[r(n,{label:"$",value:"USD"}),r(n,{label:"¥",value:"CNY"})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}}},st=ce(it,[["__scopeId","data-v-113a37e9"]]),Oe=o=>(Ve("data-v-db9b6816"),o=o(),De(),o),ut={key:0,class:"no-image"},dt=Oe(()=>S("span",{class:"iconfont icon-upload"},null,-1)),rt=Oe(()=>S("span",null,"拖入图片或点击上传",-1)),ct=[dt,rt],ht={key:1,class:"image-preview"},vt={class:"image-item"},mt=["src"],pt={key:0,class:"modal"},gt=["src"],ft={__name:"XImageUpload",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const e=ge("commonClass");console.log(e);const t=j(o,"modelValue"),l=C(!1),a=C(""),v=y=>{var u;y.preventDefault();const s=(u=y.dataTransfer)==null?void 0:u.files;s&&s.length>0&&n(s)},n=y=>{if(y.length>0){const s=y[0];e.uploadImages(s).then(u=>{t.value=u.data}).catch(u=>{console.log(u),le.error(u)})}},m=y=>{const s=y.target;s.files&&s.files.length>0&&n(s.files)},h=y=>{a.value=y,l.value=!0},i=()=>{l.value=!1,a.value=""};return(y,s)=>(U(),N(re,null,[S("div",{class:"x-image-upload",onDragover:s[1]||(s[1]=be(()=>{},["prevent"])),onDrop:v,onClick:s[2]||(s[2]=u=>y.$refs.fileInput.click())},[S("input",{type:"file",onChange:m,style:{display:"none"},ref:"fileInput"},null,544),t.value?(U(),N("div",ht,[S("div",vt,[t.value?(U(),N("img",{key:0,src:t.value,alt:"uploaded image",onClick:s[0]||(s[0]=be(u=>h(t.value),["stop"]))},null,8,mt)):ae("",!0)])])):(U(),N("div",ut,ct))],32),l.value?(U(),N("div",pt,[S("span",{class:"close",onClick:i},"×"),S("img",{class:"modal-content",src:a.value},null,8,gt)])):ae("",!0)],64))}},Le=ce(ft,[["__scopeId","data-v-db9b6816"]]),yt={class:"calcBox"},xt={class:"bg-img"},wt={class:"canvas-container"},bt={__name:"SmallCard",props:Ae({hasOpenRegion:Boolean},{initData:{},initDataModifiers:{}}),emits:["update:initData"],setup(o){const e=j(o,"initData");e.smallBoxCodePosition=e.smallBoxCodePosition||"BL";const t=C(null),l=[{text:"48*76",value:{width:48,height:76}},{text:"48*96",value:{width:48,height:96}},{text:"47.5*66",value:{width:47.5,height:66}},{text:"50.8*88.9",value:{width:50.8,height:88.9}},{text:"51*76",value:{width:51,height:76}},{text:"51*51",value:{width:51,height:51}},{text:"42*71",value:{width:42,height:71}},{text:"44*60",value:{width:44,height:60}}],a=[{text:"1",value:1},{text:"3",value:3},{text:"5",value:5}],v=[{text:"上",value:"T"},{text:"下",value:"B"},{text:"左",value:"L"},{text:"右",value:"R"}],n=[{text:"下左",value:"BL"},{text:"下中",value:"BC"},{text:"下右",value:"BR"}],m=()=>{const s={width:0,height:0,thickness:0},u=1,c=2,k=i(e.value.quantityPerBox),d=(f,T=0)=>{const O=e.value.size.width,D=e.value.size.height,_=.67,L=e.value.quantityPerBox;if(f=f,T==0&&L/f>500)return;const V={width:O*f,height:D,thickness:_*(L/f)+15},P=V.width/V.thickness;P>=u&&P<=c&&(s.width=Math.ceil(V.width),s.height=Math.ceil(V.height),s.thickness=Math.ceil(V.thickness),e.value.columnCount=f,e.value.columnQuantity=Math.ceil(L/f),e.value.box=s)};k.forEach(f=>{s.width===0&&d(f,9999)});let I=0;for(;s.width==0&&I<2;){if(s.width===0)for(let f=1;f<=1e3&&(d(f,I),s.width===0);f++);I++}},h=(s,u)=>{const c=e.value.size.width,k=e.value.size.height,d=.67;u||(u=e.value.quantityPerBox/s),s||(s=e.value.quantityPerBox/u),e.value.columnQuantity=u,e.value.columnCount=Math.ceil(s);const I={width:c*s,height:k,thickness:d*u+15},f={width:Math.ceil(I.width),height:Math.ceil(I.height),thickness:Math.ceil(I.thickness)};e.value.box=f},i=s=>{const u=[];for(let c=1;c<=s;c++)s%c===0&&u.push(c);return u};return ie(()=>e.value.box,s=>{const u=t.value,c=u.getContext("2d"),k=u.width,d=u.height,I=k/(s.width+s.thickness),f=d/(s.height+s.thickness),T=d/(s.height+s.thickness),O=Math.min(I,f,T)*.8,D=u.width/2,_=u.height/2,L=s.width*O,V=s.height*O,P=s.thickness*O*.5;c.clearRect(0,0,u.width,u.height),c.beginPath(),c.moveTo(D-L/2,_-V/2),c.lineTo(D+L/2,_-V/2),c.lineTo(D+L/2,_+V/2),c.lineTo(D-L/2,_+V/2),c.closePath(),c.stroke(),c.setLineDash([2,2]),c.beginPath(),c.moveTo(D-L/2+P,_-V/2-P),c.lineTo(D+L/2+P,_-V/2-P),c.lineTo(D+L/2+P-V,_+V/2-P),c.lineTo(D-L/2+P,_+V/2-P),c.closePath(),c.stroke(),c.setLineDash([]),c.setLineDash([2,2]),c.beginPath(),c.moveTo(D-L/2,_-V/2),c.lineTo(D-L/2+P,_-V/2-P),c.moveTo(D-L/2+V,_+V/2-V),c.lineTo(D-L/2+P,_+V/2-P),c.stroke(),c.setLineDash([]),c.beginPath(),c.moveTo(D+L/2,_-V/2),c.lineTo(D+L/2+P,_-V/2-P),c.lineTo(D+L/2+P,_+V/2-P),c.lineTo(D+L/2,_+V/2),c.closePath(),c.stroke(),c.font="14px Arial",c.fillText(`长: ${s.width}mm`,D,_+V),c.fillText(`高: ${s.height}mm`,D+L/2+10,_+V/2),c.fillText(`宽: ${s.thickness}mm`,D-L/2-P,_+V/2-P-10)},{deep:!0}),ie(()=>e.value.size,s=>{m()}),ie(()=>e.value.quantityPerBox,s=>{m()}),ie(()=>e.value.columnCount,s=>{h(s,null)}),ie(()=>e.value.columnQuantity,s=>{h(null,s)}),(s,u)=>{const c=J("el-input"),k=J("el-input-number");return U(),se(we,{title:"小卡信息"},{default:x(()=>[r(X,{label:"尺寸(mm)",padding:"0 0 10px 0"},{default:x(()=>[r(pe,{disabled:o.hasOpenRegion,disabledText:"宣传卡揭开区已创建，禁止修改，如需修改，请先清空揭开区。",modelValue:e.value.size,"onUpdate:modelValue":u[0]||(u[0]=d=>e.value.size=d),DataList:l,type:"radio"},null,8,["disabled","modelValue"])]),_:1}),r(X,{label:"揭开口数量",padding:"0 0 10px 0"},{default:x(()=>[r(pe,{modelValue:e.value.openQuantity,"onUpdate:modelValue":u[1]||(u[1]=d=>e.value.openQuantity=d),DataList:a,type:"radio"},null,8,["modelValue"])]),_:1}),r(X,{label:"小卡单价",width:"220px",padding:"0 0 18px 0"},{default:x(()=>[r(c,{modelValue:e.value.price,"onUpdate:modelValue":u[2]||(u[2]=d=>e.value.price=d),placeholder:"请输入小卡单价"},null,8,["modelValue"])]),_:1}),r(X,{label:"刀模开口方向",padding:"0 0 10px 0"},{default:x(()=>[r(pe,{modelValue:e.value.openDirection,"onUpdate:modelValue":u[3]||(u[3]=d=>e.value.openDirection=d),DataList:v,type:"radio"},null,8,["modelValue"])]),_:1}),r(X,{label:"盒号",padding:"0 0 18px 0",width:"220px"},{default:x(()=>[r(c,{modelValue:e.value.smallBoxCode,"onUpdate:modelValue":u[4]||(u[4]=d=>e.value.smallBoxCode=d)},null,8,["modelValue"])]),_:1}),r(X,{label:"盒号位置",padding:"0 0 10px 0"},{default:x(()=>[r(pe,{modelValue:e.value.smallBoxCodePosition,"onUpdate:modelValue":u[5]||(u[5]=d=>e.value.smallBoxCodePosition=d),DataList:n,type:"radio"},null,8,["modelValue"])]),_:1}),r(X,{label:"盒数",padding:"0 0 18px 0"},{default:x(()=>[r(k,{modelValue:e.value.boxCount,"onUpdate:modelValue":u[6]||(u[6]=d=>e.value.boxCount=d),min:1},null,8,["modelValue"])]),_:1}),r(X,{label:"每盒数量",padding:"0 0 18px 0"},{default:x(()=>[r(k,{disabled:o.hasOpenRegion,modelValue:e.value.quantityPerBox,"onUpdate:modelValue":u[7]||(u[7]=d=>e.value.quantityPerBox=d),min:1},null,8,["disabled","modelValue"])]),_:1}),S("div",yt,[r(X,{label:"列数",padding:"0 0 18px 0",width:"220px"},{default:x(()=>[r(k,{step:1,disabled:o.hasOpenRegion,modelValue:e.value.columnCount,"onUpdate:modelValue":u[8]||(u[8]=d=>e.value.columnCount=d),min:1},null,8,["disabled","modelValue"])]),_:1}),r(X,{label:"每列数量",padding:"0 0 18px 0",width:"220px"},{default:x(()=>[r(k,{disabled:o.hasOpenRegion,modelValue:e.value.columnQuantity,"onUpdate:modelValue":u[9]||(u[9]=d=>e.value.columnQuantity=d),min:1},null,8,["disabled","modelValue"])]),_:1})]),S("div",xt,[r(X,{label:"正面背景",width:"48%"},{default:x(()=>[r(Le,{modelValue:e.value.frontImage,"onUpdate:modelValue":u[10]||(u[10]=d=>e.value.frontImage=d)},null,8,["modelValue"])]),_:1}),r(X,{label:"小卡揭开面背景",width:"48%"},{default:x(()=>[r(Le,{modelValue:e.value.backImage,"onUpdate:modelValue":u[11]||(u[11]=d=>e.value.backImage=d)},null,8,["modelValue"])]),_:1})]),S("div",wt,[S("canvas",{ref_key:"boxCanvas",ref:t,width:"500",height:"500"},null,512)])]),_:1})}}},At=ce(bt,[["__scopeId","data-v-79a2a318"]]),Ct=o=>(Ve("data-v-515664c6"),o=o(),De(),o),kt={key:0,class:"game-area"},_t=Ct(()=>S("p",{class:"title"},"游戏区",-1)),Mt={class:"game-area-list"},Vt=["onClick"],Dt=["onClick"],Rt={__name:"GameAreaPanel",props:Ae({mode:String},{gameAreas:{},gameAreasModifiers:{},selectedGameArea:{},selectedGameAreaModifiers:{},revealAreas:{},revealAreasModifiers:{}}),emits:["update:gameAreas","update:selectedGameArea","update:revealAreas"],setup(o){const e=j(o,"gameAreas"),t=j(o,"selectedGameArea"),l=j(o,"revealAreas"),a=ge("drawCanvas"),v=m=>{t.value&&t.value.id===m.id?t.value=null:t.value=m,a()},n=m=>{e.value=e.value.filter(h=>h.id!==m.id),m.areas.forEach(h=>{h.drawData=[]}),l.value.push(...m.areas),t.value&&t.value.id===m.id&&(t.value=null),a()};return(m,h)=>o.mode==="select"?(U(),N("div",kt,[_t,S("div",Mt,[(U(!0),N(re,null,he(e.value,i=>(U(),N("div",{key:i.id,class:Ge(["game-area-item",{selected:t.value&&t.value.id===i.id}]),onClick:y=>v(i)},[S("span",null,me(i.name),1),S("span",{class:"iconfont icon-close",onClick:be(y=>n(i),["stop"])},null,8,Dt)],10,Vt))),128))])])):ae("",!0)}},zt=ce(Rt,[["__scopeId","data-v-515664c6"]]),Re=o=>(Ve("data-v-b5008c25"),o=o(),De(),o),Ut={key:0,class:"pa-input"},It=Re(()=>S("p",null,"游戏区名称",-1)),St=Re(()=>S("p",null,"奖符数据",-1)),Bt=Re(()=>S("p",null,"奖符数据列表(未使用)",-1)),$t={class:"data-list"},Pt=Re(()=>S("p",null,"奖符数据列表(已使用)",-1)),Tt={__name:"MarkAreaPanel",props:{selectedGameArea:{},selectedGameAreaModifiers:{}},emits:["update:selectedGameArea"],setup(o){const e=j(o,"selectedGameArea"),t=C("");ie(()=>e.value,v=>{v&&(t.value="")});const l=v=>{if(v.key==="Enter"){const n=t.value.trim();n&&(e.value.range||(e.value.range=[]),e.value.range.push(n),t.value="")}},a=v=>{e.value.range.splice(v,1)};return(v,n)=>{var y;const m=J("el-input"),h=J("el-tooltip"),i=J("el-tag");return e.value?(U(),N("div",Ut,[It,r(m,{placeholder:"请输入游戏区名称",modelValue:e.value.name,"onUpdate:modelValue":n[0]||(n[0]=s=>e.value.name=s),onKeydown:l},null,8,["modelValue"]),St,r(h,{class:"box-item",effect:"dark",content:"输入数据后，按【回车】按键添加",placement:"right"},{default:x(()=>[r(m,{ref:"inputRef",placeholder:"请输入奖符数据",modelValue:t.value,"onUpdate:modelValue":n[1]||(n[1]=s=>t.value=s),onKeydown:l},null,8,["modelValue"])]),_:1}),Bt,S("div",$t,[(U(!0),N(re,null,he((y=e.value)==null?void 0:y.range,(s,u)=>(U(),se(i,{type:"primary",key:u,onClose:c=>a(u),closable:""},{default:x(()=>[K(me(s),1)]),_:2},1032,["onClose"]))),128))]),Pt,(U(!0),N(re,null,he(e.value.areas,(s,u)=>(U(),N("div",{class:"data-list",key:u},[(U(!0),N(re,null,he(s.drawData,(c,k)=>(U(),se(i,{type:"warning",key:k},{default:x(()=>[K(me(c),1)]),_:2},1024))),128))]))),128))])):ae("",!0)}}},Lt=ce(Tt,[["__scopeId","data-v-b5008c25"]]);var ne=[];for(var Ue=0;Ue<256;++Ue)ne.push((Ue+256).toString(16).slice(1));function Et(o,e=0){return(ne[o[e+0]]+ne[o[e+1]]+ne[o[e+2]]+ne[o[e+3]]+"-"+ne[o[e+4]]+ne[o[e+5]]+"-"+ne[o[e+6]]+ne[o[e+7]]+"-"+ne[o[e+8]]+ne[o[e+9]]+"-"+ne[o[e+10]]+ne[o[e+11]]+ne[o[e+12]]+ne[o[e+13]]+ne[o[e+14]]+ne[o[e+15]]).toLowerCase()}var ke,Gt=new Uint8Array(16);function Ft(){if(!ke&&(ke=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ke))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ke(Gt)}var Nt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ee={randomUUID:Nt};function Me(o,e,t){if(Ee.randomUUID&&!e&&!o)return Ee.randomUUID();o=o||{};var l=o.random||(o.rng||Ft)();return l[6]=l[6]&15|64,l[8]=l[8]&63|128,Et(l)}const Ot={class:"auto-action"},Xt={__name:"TopActionPanel",props:{mode:{},modeModifiers:{},selectedAreas:{},selectedAreasModifiers:{},revealAreas:{},revealAreasModifiers:{},gameAreas:{},gameAreasModifiers:{},selectedGameArea:{},selectedGameAreaModifiers:{},activeArea:{},activeAreaModifiers:{}},emits:["update:mode","update:selectedAreas","update:revealAreas","update:gameAreas","update:selectedGameArea","update:activeArea"],setup(o){const e=j(o,"mode"),t=j(o,"selectedAreas"),l=j(o,"revealAreas"),a=j(o,"gameAreas"),v=j(o,"selectedGameArea"),n=j(o,"activeArea"),m=ge("drawCanvas"),h=[{text:"选择模式",value:"select"},{text:"创建模式",value:"create"}],i=()=>{t.value=l.value,m()},y=()=>{t.value=[],m()},s=()=>{const c={id:Me(),name:`游戏区${a.value.length+1}`,areas:t.value,range:[],selected:!1};a.value.push(c),l.value=l.value.filter(k=>!t.value.includes(k)),t.value=[],m()},u=()=>{ElMessageBox.confirm("是否清空所有区域?").then(()=>{l.value=[],a.value=[],t.value=[],v.value=null,n.value=null,m()}).catch(()=>{})};return(c,k)=>{const d=J("el-button");return U(),N("div",Ot,[r(pe,{modelValue:e.value,"onUpdate:modelValue":k[0]||(k[0]=I=>e.value=I),margin:"0px 8px 0px 0px",DataList:h,type:"radio"},null,8,["modelValue"]),t.value.length>0&&e.value==="select"?(U(),se(d,{key:0,onClick:s,type:"primary"},{default:x(()=>[K("创建游戏区")]),_:1})):ae("",!0),e.value==="select"?(U(),se(d,{key:1,onClick:i,type:"primary",plain:""},{default:x(()=>[K("全选")]),_:1})):ae("",!0),e.value==="select"?(U(),se(d,{key:2,onClick:y,type:"primary",plain:""},{default:x(()=>[K("取消全选")]),_:1})):ae("",!0),r(d,{onClick:u,type:"danger",plain:""},{default:x(()=>[K("清空")]),_:1})])}}},Qt=ce(Xt,[["__scopeId","data-v-d25823cc"]]),Wt={__name:"ContextMenu",props:Ae({mode:String,contextMenuPosition:Object,rightClickedArea:Object},{revealAreas:{},revealAreasModifiers:{},showContextMenu:{},showContextMenuModifiers:{},activeArea:{},activeAreaModifiers:{},setQtyDialogVisible:{},setQtyDialogVisibleModifiers:{},selectedGameArea:{},selectedGameAreaModifiers:{}}),emits:["update:revealAreas","update:showContextMenu","update:activeArea","update:setQtyDialogVisible","update:selectedGameArea"],setup(o){const e=j(o,"revealAreas"),t=j(o,"showContextMenu"),l=j(o,"activeArea"),a=j(o,"setQtyDialogVisible"),v=j(o,"selectedGameArea"),n=o,m=ge("drawCanvas");ye(()=>{window.addEventListener("click",u=>{u.target.matches(".context-menu, .context-menu *")||(t.value=!1)})}),Ye(()=>{window.removeEventListener("click",u=>{u.target.matches(".context-menu, .context-menu *")||(t.value=!1)})});const h=()=>{if(n.rightClickedArea){const u={...n.rightClickedArea,x:n.rightClickedArea.x+10,y:n.rightClickedArea.y+10};e.value.push(u),m()}t.value=!1},i=()=>{n.rightClickedArea&&(e.value=e.value.filter(u=>u!==n.rightClickedArea),m()),t.value=!1},y=()=>{a.value=!0,t.value=!1},s=()=>{l.value.drawData&&(v.value.range.push(...l.value.drawData),l.value.drawData=[],m()),t.value=!1};return(u,c)=>t.value?(U(),N("ul",{key:0,class:"context-menu",style:Fe({top:`${o.contextMenuPosition.y}px`,left:`${o.contextMenuPosition.x}px`})},[o.mode=="create"?(U(),N("li",{key:0,onClick:h},"复制")):ae("",!0),o.mode=="create"?(U(),N("li",{key:1,onClick:i},"删除")):ae("",!0),o.mode=="select"?(U(),N("li",{key:2,onClick:y},"设置奖符数量")):ae("",!0),o.mode=="select"?(U(),N("li",{key:3,onClick:s},"移出所有奖符")):ae("",!0)],4)):ae("",!0)}},qt=ce(Wt,[["__scopeId","data-v-d733fa8d"]]),Ht={__name:"SetMarkQtyPanel",props:{selectedGameArea:{},selectedGameAreaModifiers:{},activeArea:{},activeAreaModifiers:{},setQtyDialogVisible:{},setQtyDialogVisibleModifiers:{}},emits:["update:selectedGameArea","update:activeArea","update:setQtyDialogVisible"],setup(o){const e=j(o,"selectedGameArea"),t=j(o,"activeArea"),l=j(o,"setQtyDialogVisible"),a=ge("drawCanvas"),v=C(1),n=()=>{Array.isArray(t.value.drawData)&&e.value.range.push(...t.value.drawData);const h=e.value.range.sort(()=>.5-Math.random()).slice(0,v.value);if(h.length<v.value){ElMessage.error("奖符数据不足！");return}t.value.drawData=h;const i=h.reduce((y,s)=>(y[s]=(y[s]||0)+1,y),{});e.value.range=e.value.range.filter(y=>i[y]?(i[y]-=1,!1):!0),l.value=!1,a()},m=()=>{l.value=!1};return(h,i)=>{const y=J("el-slider"),s=J("el-button"),u=J("el-dialog");return U(),se(u,{modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=c=>l.value=c),width:600,"destroy-on-close":!0,title:"该揭开区有几个奖符？","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:x(()=>[r(s,{onClick:m},{default:x(()=>[K("取消")]),_:1}),r(s,{type:"primary",onClick:n},{default:x(()=>[K("确定")]),_:1})]),default:x(()=>{var c,k;return[r(y,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=d=>v.value=d),min:1,max:((c=e.value.range)==null?void 0:c.length)==0?1:(k=e.value.range)==null?void 0:k.length,"show-input":""},null,8,["modelValue","max"])]}),_:1},8,["modelValue"])}}},Yt=(o,e,t,l,a,v,n)=>{switch(t.value){case"top-left":Ie(e,l,a,v,n),Be(o,l,a,v,n);break;case"top-right":Ie(e,l,a,v,n),$e(o,l,a,v,n);break;case"bottom-left":Se(e,l,a,v,n),Be(o,l,a,v,n);break;case"bottom-right":Se(e,l,a,v,n),$e(o,l,a,v,n);break;case"left":Be(o,l,a,v,n);break;case"right":$e(o,l,a,v,n);break;case"top":Ie(e,l,a,v,n);break;case"bottom":Se(e,l,a,v,n);break}},Ie=(o,e,t,l,a)=>{const v=e.value.height;e.value.height+=e.value.y-o,e.value.y=o,e.value.height<10&&(e.value.y-=10-v,e.value.height=10),l.value=[],t.value.forEach(n=>{n!==e.value&&Math.abs(e.value.y-n.y)==0&&(e.value.y=n.y,l.value.push({x:0,y:n.y,width:a.value.width,height:1}))})},Se=(o,e,t,l,a)=>{const v=Math.max(o,e.value.y+10);e.value.height=v-e.value.y,l.value=[],t.value.forEach(n=>{n!==e.value&&Math.abs(e.value.y+e.value.height-n.y-n.height)==0&&l.value.push({x:0,y:n.y+n.height,width:a.value.width,height:1})})},Be=(o,e,t,l,a)=>{const v=e.value.width;e.value.width+=e.value.x-o,e.value.x=o,e.value.width<10&&(e.value.x-=10-v,e.value.width=10),l.value=[],t.value.forEach(n=>{n!==e.value&&Math.abs(e.value.x-n.x)==0&&l.value.push({x:n.x,y:0,width:1,height:a.value.height})})},$e=(o,e,t,l,a)=>{const v=Math.max(o,e.value.x+10);e.value.width=v-e.value.x,l.value=[],t.value.forEach(n=>{n!==e.value&&Math.abs(e.value.x+e.value.width-n.x-n.width)==0&&l.value.push({x:n.x+n.width,y:0,width:1,height:a.value.height})})},jt=(o,e,t,l)=>{let a="default";t.value.forEach(v=>{if(o>=v.x&&o<=v.x+v.width&&e>=v.y&&e<=v.y+v.height){const n=Math.abs(o-v.x)<10,m=Math.abs(o-(v.x+v.width))<10,h=Math.abs(e-v.y)<10,i=Math.abs(e-(v.y+v.height))<10;h&&n?a="nw-resize":h&&m?a="ne-resize":i&&n?a="sw-resize":i&&m?a="se-resize":h?a="n-resize":i?a="s-resize":n?a="w-resize":m?a="e-resize":a="move"}}),l.value.style.cursor=a},Kt=(o,e,t)=>{const l=Math.abs(o-t.x)<10,a=Math.abs(o-(t.x+t.width))<10,v=Math.abs(e-t.y)<10,n=Math.abs(e-(t.y+t.height))<10;return l&&v?"top-left":a&&v?"top-right":l&&n?"bottom-left":a&&n?"bottom-right":l?"left":a?"right":v?"top":n?"bottom":""};class Jt{constructor(e,t){this.adCardWidth=0,this.adCardHeight=0,this.imageWidth=t.width,this.imageHeight=t.height,this.imageWidth>this.imageHeight?(this.adCardWidth=Math.max(...e),this.adCardHeight=Math.min(...e)):(this.adCardWidth=Math.min(...e),this.adCardHeight=Math.max(...e))}mmToPx(e){return e*this.imageWidth/this.adCardWidth}pxToMm(e){return e*this.adCardWidth/this.imageWidth}}class Zt{constructor(e,t){Ce(this,"getIntersections",(e,t,l)=>{const a=[];return[{x1:t.x*l,y1:t.y*l,x2:(t.x+t.width)*l,y2:t.y*l},{x1:t.x*l,y1:(t.y+t.height)*l,x2:(t.x+t.width)*l,y2:(t.y+t.height)*l},{x1:t.x*l,y1:t.y*l,x2:t.x*l,y2:(t.y+t.height)*l},{x1:(t.x+t.width)*l,y1:t.y*l,x2:(t.x+t.width)*l,y2:(t.y+t.height)*l}].forEach(n=>{const m=this.getLineIntersection(e,n);m&&a.push(m)}),a});Ce(this,"getLineIntersection",(e,t)=>{const{x1:l,y1:a,x2:v,y2:n}=e,{x1:m,y1:h,x2:i,y2:y}=t,s=(l-v)*(h-y)-(a-n)*(m-i);if(s===0)return null;const u=((l-m)*(h-y)-(a-h)*(m-i))/s,c=-((l-v)*(a-h)-(a-n)*(l-m))/s;return u>=0&&u<=1&&c>=0&&c<=1?{x:l+u*(v-l),y:a+u*(n-a)}:null});Ce(this,"getDistance",(e,t,l,a)=>Math.sqrt((l-e)**2+(a-t)**2));this.pxToMm=e,this.revealAreas=t}drawDistanceLines(e,t,l){const a=e.value.getContext("2d");a.strokeStyle="blue",a.fillStyle="blue",a.font="12px Arial",a.lineWidth=1;const v=5,n=3;[{side:"top",x1:l.x*t+l.width*t/2,y1:l.y*t,x2:l.x*t+l.width*t/2,y2:0},{side:"bottom",x1:l.x*t+l.width*t/2,y1:(l.y+l.height)*t,x2:l.x*t+l.width*t/2,y2:e.value.height},{side:"left",x1:l.x*t,y1:l.y*t+l.height*t/2,x2:0,y2:l.y*t+l.height*t/2},{side:"right",x1:(l.x+l.width)*t,y1:l.y*t+l.height*t/2,x2:e.value.width,y2:l.y*t+l.height*t/2}].forEach(h=>{let i=null,y=1/0;if(this.revealAreas.value.forEach(d=>{d!==l&&this.getIntersections(h,d,t).forEach(f=>{const T=this.getDistance(h.x1,h.y1,f.x,f.y);T<y&&(y=T,i=f)})}),a.beginPath(),a.moveTo(h.x1,h.y1),i)a.lineTo(i.x,i.y),h.label=`${this.pxToMm(y/t).toFixed(2)} mm`;else{a.lineTo(h.x2,h.y2);const d=h.side==="top"||h.side==="bottom"?Math.abs(h.y1-h.y2):Math.abs(h.x1-h.x2);h.label=`${this.pxToMm(d/t).toFixed(2)} mm`}a.stroke();const s=a.measureText(h.label).width,u=12,c=(h.x1+(i?i.x:h.x2))/2-s/2-v,k=(h.y1+(i?i.y:h.y2))/2-u/2-n;a.fillStyle="white",a.fillRect(c,k,s+2*v,u+2*n),a.strokeStyle="black",a.strokeRect(c,k,s+2*v,u+2*n),a.fillStyle="black",a.fillText(h.label,c+v,k+u+n/2)})}}class el{constructor(e){this.scale=e.scale,this.mode=e.mode,this.activeArea=e.activeArea,this.revealAreas=e.revealAreas,this.selectedAreas=e.selectedAreas,this.alignLine=e.alignLine,this.selectedGameArea=e.selectedGameArea,this.backgroundImageUrl=e.backgroundImageUrl,this.canvasRef=e.canvasRef,this.editorRef=e.editorRef,this.mmToPx=e.mmToPx,this.pxToMm=e.pxToMm,this.drawDistanceLines=e.drawDistanceLines}loadImage(e){return new Promise((t,l)=>{const a=new Image;a.onload=()=>t(a),a.onerror=l,a.src=e})}async drawCanvas(){if(!this.canvasRef.value||!this.editorRef.value){console.error("Canvas or editor not mounted yet");return}const e=this.canvasRef.value.getContext("2d");if(this.backgroundImageUrl){const t=await this.loadImage(this.backgroundImageUrl),l=this.editorRef.value.clientWidth,a=this.editorRef.value.clientHeight;this.scale.value=Math.min(l/t.width,a/t.height),this.canvasRef.value.width=t.width*this.scale.value,this.canvasRef.value.height=t.height*this.scale.value,e.drawImage(t,0,0,this.canvasRef.value.width,this.canvasRef.value.height)}this.renderAreas(e),this.renderAlignLines(e),this.activeArea.value&&this.drawDistanceLines(this.canvasRef,this.scale.value,this.activeArea.value)}renderAreas(e){switch(this.mode.value){case"create":this.createModeRenderAreas(e);break;case"select":this.selectModeRenderAreas(e);break}}createModeRenderAreas(e){this.revealAreas.value.forEach(t=>{e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value),e.strokeStyle=t===this.activeArea.value?"red":"#FFF",e.strokeRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value)})}selectModeRenderAreas(e){this.selectedGameArea.value?this.selectedGameArea.value.areas.forEach(t=>{e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value),e.strokeStyle=t===this.activeArea.value?"red":"#FFF",e.strokeRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value),t.drawData&&this.renderRangeText(t,t.drawData)}):this.revealAreas.value.forEach(t=>{e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value),e.strokeStyle=t===this.activeArea.value?"red":"#FFF",e.strokeRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value)}),this.selectedAreas.value&&(e.strokeStyle="red",this.selectedAreas.value.forEach(t=>{e.strokeRect(t.x*this.scale.value,t.y*this.scale.value,t.width*this.scale.value,t.height*this.scale.value)}))}renderAlignLines(e){this.alignLine.value&&(e.fillStyle="red",this.alignLine.value.forEach(t=>{e.fillRect(t.x*this.scale.value,t.y*this.scale.value,t.width,t.height)}))}async renderRangeText(e,t){const l=this.canvasRef.value.getContext("2d");let a=30;const v=7,n=this.mmToPx(3);let m=1;const h=3;let i=(e.width-2*n)*this.scale.value/m,y;l.textBaseline="middle",l.fillStyle="white";let s=[];for(let u=0;u<t.length;u++){let c=!1,k=t[u],d,I;for(m=1,a=30,i=(e.width-2*n)*this.scale.value/m;!c&&m<=h;){for(y=(e.height-2*n)*this.scale.value/Math.ceil(t.length/m);a>=v&&!c;)({width:d,height:I}=this.measureText(l,k,a)),d<=i&&I<=y?c=!0:a--;if(!c&&m<h)m++,a=30,i=(e.width-2*n)*this.scale.value/m;else break}if(!c){ElMessageBox.alert("应用已经尽力自适应文本，但是奖符数量过多过长无法渲染，请调整文本或区域大小后重试！","超出限制",{confirmButtonText:"好的"}),this.selectedGameArea.value.range.push(...this.activeArea.value.drawData),this.activeArea.value.drawData=[];break}const f=(e.width-2*n)*this.scale.value/m,T=u%m,O=Math.floor(u/m),D=(e.x+n)*this.scale.value+f*T+(f-d)/2,_=(e.y+n)*this.scale.value+y*O+y/2;l.fillText(k,D,_),s.push({x:D/this.scale.value,y:_/this.scale.value,width:d/this.scale.value,height:I/this.scale.value,text:k,fontSize:a})}e.mark=s}measureText(e,t,l){return e.font=`${l}px Arial`,{width:e.measureText(t).width,height:l+4}}checkAlignLine(){this.alignLine.value=[];const e=20;this.revealAreas.value.forEach(t=>{if(t===this.activeArea.value)return;const l=Math.abs(this.activeArea.value.x-t.x),a=Math.abs(this.activeArea.value.x+this.activeArea.value.width-t.x-t.width),v=Math.abs(this.activeArea.value.y-t.y),n=Math.abs(this.activeArea.value.y+this.activeArea.value.height-t.y-t.height);(l<e||a<e)&&(l<a?(this.activeArea.value.x=t.x,this.alignLine.value.push({x:t.x,y:0,width:1,height:this.canvasRef.value.height}),this.activeArea.value.width===t.width&&this.alignLine.value.push({x:t.x+t.width,y:0,width:1,height:this.canvasRef.value.height})):(this.activeArea.value.x=t.x+t.width-this.activeArea.value.width,this.alignLine.value.push({x:t.x+t.width,y:0,width:1,height:this.canvasRef.value.height}),this.activeArea.value.width===t.width&&this.alignLine.value.push({x:t.x,y:0,width:1,height:this.canvasRef.value.height}))),(v<e||n<e)&&(v<n?(this.activeArea.value.y=t.y,this.alignLine.value.push({x:0,y:t.y,width:this.canvasRef.value.width,height:1}),this.activeArea.value.height===t.height&&this.alignLine.value.push({x:0,y:t.y+t.height,width:this.canvasRef.value.width,height:1})):(this.activeArea.value.y=t.y+t.height-this.activeArea.value.height,this.alignLine.value.push({x:0,y:t.y+t.height,width:this.canvasRef.value.width,height:1}),this.activeArea.value.height===t.height&&this.alignLine.value.push({x:0,y:t.y,width:this.canvasRef.value.width,height:1})))})}}const tl={__name:"RevealAreaEditor",props:{backgroundImageUrl:String,preAreas:Array,adCardSize:Array,imageSize:Object},setup(o,{expose:e}){const t=o,l=new Jt(t.adCardSize,t.imageSize),a=l.mmToPx.bind(l),v=l.pxToMm.bind(l),n=C(null),m=C(null),h=C([]),i=C(Pe.cloneDeep(t.preAreas||[])),y=C(null),s=C("create"),u=C([]),c=C(null),k=C(!1),d=C(!1),I=C(""),f=C(0),T=C(0),O=C([]),D=C(!1),_=C({x:0,y:0}),L=C(!1),V=C(null),P=C(1),Z=new Zt(v,h),b={canvasRef:n,editorRef:m,scale:P,alignLine:O,selectedGameArea:y,activeArea:c,selectedAreas:u,revealAreas:h,mode:s,backgroundImageUrl:t.backgroundImageUrl,mmToPx:a,pxToMm:v,drawDistanceLines:Z.drawDistanceLines.bind(Z)},$=new el(b),q=$.drawCanvas.bind($),ee=$.checkAlignLine.bind($);Ne("drawCanvas",q),ie(s,W=>{W==="create"&&(y.value=null,u.value=[],q())}),ie(()=>y.value,W=>{console.log(W)}),ie(()=>t.backgroundImageUrl,W=>{n.value&&m.value&&q()},{immediate:!0}),ye(()=>{q()});const ue=W=>{const R=n.value.getBoundingClientRect(),F=(W.clientX-R.left)/P.value,A=(W.clientY-R.top)/P.value;if(s.value==="select"?V.value=y.value.areas.find(B=>F>=B.x&&F<=B.x+B.width&&A>=B.y&&A<=B.y+B.height):V.value=h.value.find(B=>F>=B.x&&F<=B.x+B.width&&A>=B.y&&A<=B.y+B.height),V.value){W.preventDefault(),D.value=!0;const B=m.value.getBoundingClientRect();_.value={x:W.clientX-B.left+window.scrollX,y:W.clientY-B.top},c.value=V.value}else D.value=!1},te=W=>{if(s.value==="create"){const R=n.value.getBoundingClientRect(),F=(W.clientX-R.left)/P.value,A=(W.clientY-R.top)/P.value;if(k.value=!1,d.value=!1,c.value=null,h.value.forEach(B=>{F>=B.x&&F<=B.x+B.width&&A>=B.y&&A<=B.y+B.height&&(f.value=F-B.x,T.value=A-B.y,c.value=B,F>B.x+B.width-10||F<B.x+10||A>B.y+B.height-10||A<B.y+10?(d.value=!0,I.value=Kt(F,A,B)):k.value=!0)}),!c.value){const B={x:F,y:A,width:0,height:0};h.value.push(B),c.value=B,d.value=!0,I.value="bottom-right"}}else if(s.value==="select"){const R=n.value.getBoundingClientRect(),F=(W.clientX-R.left)/P.value,A=(W.clientY-R.top)/P.value;let B=!1;u.value.forEach(Y=>{F>=Y.x&&F<=Y.x+Y.width&&A>=Y.y&&A<=Y.y+Y.height&&(B=!0)}),B?u.value=u.value.filter(Y=>!(F>=Y.x&&F<=Y.x+Y.width&&A>=Y.y&&A<=Y.y+Y.height)):h.value.forEach(Y=>{F>=Y.x&&F<=Y.x+Y.width&&A>=Y.y&&A<=Y.y+Y.height&&u.value.push(Y)}),q()}},G=W=>{const R=n.value.getBoundingClientRect(),F=(W.clientX-R.left)/P.value,A=(W.clientY-R.top)/P.value;k.value?(c.value.x=Math.max(0,Math.min(n.value.width/P.value-c.value.width,F-f.value)),c.value.y=Math.max(0,Math.min(n.value.height/P.value-c.value.height,A-T.value)),ee(),q()):d.value?(Yt(F,A,I,c,h,O,n),q()):jt(F,A,h,n)},Q=()=>{h.value=h.value.filter(W=>W.width>15&&W.height>15),k.value=!1,d.value=!1,c.value=null,n.value.style.cursor="default",O.value=null,q()},H=()=>{h.value=h.value.filter(W=>W.width>15&&W.height>15),k.value=!1,d.value=!1,n.value.style.cursor="default",q()};return e({drawCanvas:q,getAreas:()=>{if(h.value.length>0)return le.error("还有区域未绑定游戏区！"),[];const W=(R,F,A)=>{const{x:B,y:Y,width:xe,height:ze}=R,{x:Te,y:p,width:g,height:z}=F,M=Math.abs(B+xe-Te)<A,w=Math.abs(Y+ze-p)<A;return M||w};for(const R of i.value){const F=R.areas;if(F.some((A,B)=>F.some((Y,xe)=>B!==xe&&W(A,Y,a(6)))))return le.error("游戏区中的揭开区域间隔需要大于等于6mm！"),[]}return Pe.cloneDeep(i.value)}}),(W,R)=>{const F=je("mode");return U(),N(re,null,[Ke(r(Qt,{mode:s.value,"onUpdate:mode":R[0]||(R[0]=A=>s.value=A),selectedAreas:u.value,"onUpdate:selectedAreas":R[1]||(R[1]=A=>u.value=A),revealAreas:h.value,"onUpdate:revealAreas":R[2]||(R[2]=A=>h.value=A),gameAreas:i.value,"onUpdate:gameAreas":R[3]||(R[3]=A=>i.value=A)},null,8,["mode","selectedAreas","revealAreas","gameAreas"]),[[F,y.value,"selectedGameArea"],[F,c.value,"activeArea"]]),S("div",{class:"reveal-area-editor",ref_key:"editorRef",ref:m,onContextmenu:R[16]||(R[16]=be(A=>ue(A),["prevent"]))},[S("canvas",{ref_key:"canvasRef",ref:n,onMousedown:te,onMousemove:G,onMouseup:Q,onMouseleave:H},null,544),r(zt,{mode:s.value,gameAreas:i.value,"onUpdate:gameAreas":R[4]||(R[4]=A=>i.value=A),selectedGameArea:y.value,"onUpdate:selectedGameArea":R[5]||(R[5]=A=>y.value=A),revealAreas:h.value,"onUpdate:revealAreas":R[6]||(R[6]=A=>h.value=A)},null,8,["mode","gameAreas","selectedGameArea","revealAreas"]),r(Lt,{selectedGameArea:y.value,"onUpdate:selectedGameArea":R[7]||(R[7]=A=>y.value=A)},null,8,["selectedGameArea"]),r(qt,{mode:s.value,showContextMenu:D.value,"onUpdate:showContextMenu":R[8]||(R[8]=A=>D.value=A),contextMenuPosition:_.value,rightClickedArea:V.value,revealAreas:h.value,"onUpdate:revealAreas":R[9]||(R[9]=A=>h.value=A),activeArea:c.value,"onUpdate:activeArea":R[10]||(R[10]=A=>c.value=A),setQtyDialogVisible:L.value,"onUpdate:setQtyDialogVisible":R[11]||(R[11]=A=>L.value=A),selectedGameArea:y.value,"onUpdate:selectedGameArea":R[12]||(R[12]=A=>y.value=A)},null,8,["mode","showContextMenu","contextMenuPosition","rightClickedArea","revealAreas","activeArea","setQtyDialogVisible","selectedGameArea"]),r(Ht,{setQtyDialogVisible:L.value,"onUpdate:setQtyDialogVisible":R[13]||(R[13]=A=>L.value=A),selectedGameArea:y.value,"onUpdate:selectedGameArea":R[14]||(R[14]=A=>y.value=A),activeArea:c.value,"onUpdate:activeArea":R[15]||(R[15]=A=>c.value=A)},null,8,["setQtyDialogVisible","selectedGameArea","activeArea"])],544)],64)}}},ll=ce(tl,[["__scopeId","data-v-25897134"]]),Xe=o=>(Ve("data-v-a07a8a1d"),o=o(),De(),o),al={class:"prize-page"},ol=Xe(()=>S("p",null,"奖符数据",-1)),nl=Xe(()=>S("p",null,"奖符数据列表",-1)),il={class:"data-list"},sl={class:"auto-action"},ul={__name:"PrizeAreaEditor",props:{backgroundImageUrl:String,externalRevealAreas:Array,preAreas:Array},setup(o,{expose:e}){const t=o,l=C(null),a=C(null),v=C(null),n=C(null),m=C(Pe.cloneDeep(t.preAreas||[])),h=C(null),i=C(null),y=C(!1),s=C(!1),u=C(""),c=C(0),k=C(0),d=C(!1),I=C({x:0,y:0}),f=C(""),T=C("");let O=null,D=null,_=1;ye(()=>{te()}),ie(()=>t.backgroundImageUrl,p=>{console.log("watch"),l.value&&v.value&&te()},{immediate:!0}),ie(i,p=>{p?(f.value="",T.value="appear-tv"):T.value="disappear-tv"}),window.addEventListener("keydown",p=>{if(p.key==="Tab"&&(p.preventDefault(),m.value.length>0)){if(!i.value)i.value=m.value[0];else{const g=m.value.indexOf(i.value);g===m.value.length-1?i.value=m.value[0]:i.value=m.value[g+1]}n.value.focus(),te()}});const L=()=>{i.value=null,te()},V=p=>{if(p.key==="Enter"){const g=f.value.trim();if(g){if(i.value.range||(i.value.range=[]),i.value.range.includes(g)){le.error("奖符数据重复！");return}i.value.range.push(g),f.value=""}}},P=p=>{i.value.range.splice(p,1),console.log(i.value.range)},Z=p=>{const g=l.value.getBoundingClientRect(),z=(p.clientX-g.left)/_,M=(p.clientY-g.top)/_;if(D=m.value.find(w=>z>=w.x&&z<=w.x+w.width&&M>=w.y&&M<=w.y+w.height),D||(D=t.externalRevealAreas.find(w=>z>=w.x&&z<=w.x+w.width&&M>=w.y&&M<=w.y+w.height)),D){p.preventDefault(),d.value=!0;const w=v.value.getBoundingClientRect();console.log(w.top,w.left),I.value={x:p.clientX-w.left+window.scrollX,y:p.clientY-w.top},console.log(p.clientX,p.clientY,w.left,w.top,window.scrollX,window.scrollY,I.value.x,I.value.y),i.value=D}else d.value=!1},b=()=>{if(D){const p={...D,x:D.x+10,y:D.y+10};m.value.push(p),te()}d.value=!1},$=()=>{D&&(m.value=m.value.filter(p=>p!==D),te()),d.value=!1},q=(p,g,z)=>{if(!l.value)return;const M=()=>{m.value=[];const w=[];t.externalRevealAreas.forEach(E=>{const de={...E,parentArea:E};if(p===1)w.push(de);else{const oe=E.width*p,fe=E.height*p;g==="vertical"?(w.push({x:E.x,y:E.y,width:E.width,height:fe,parentArea:E}),w.push({x:E.x,y:E.y+E.height-fe,width:E.width,height:fe,parentArea:E})):g==="horizontal"&&(w.push({x:E.x,y:E.y,width:oe,height:E.height,parentArea:E}),w.push({x:E.x+E.width-oe,y:E.y,width:oe,height:E.height,parentArea:E}))}}),console.log(w),m.value.push(...w),te()};m.value.length>0?_e.confirm("当前有已创建的区域，继续将清除已创建的区域，是否继续?").then(()=>{M()}).catch(()=>{isContinue=!1}):M()},ee=()=>{_e.confirm("是否清空所有区域?").then(()=>{m.value=[],te()}).catch(()=>{})};window.addEventListener("click",p=>{p.target.matches(".context-menu, .context-menu *")||(d.value=!1)});const ue=p=>new Promise((g,z)=>{const M=new Image;M.onload=()=>g(M),M.onerror=z,M.src=p}),te=async()=>{if(console.log("drawCanvas"),!l.value||!v.value){console.error("Canvas or editor not mounted yet");return}const p=l.value.getContext("2d");if(t.backgroundImageUrl){console.log("props.backgroundImageUrl",t.backgroundImageUrl);const g=await ue(t.backgroundImageUrl),z=v.value.clientWidth,M=v.value.clientHeight;_=Math.min(z/g.width,M/g.height),l.value.width=g.width*_,l.value.height=g.height*_;const w=a.value.getContext("2d");a.value.width=l.value.width,a.value.height=l.value.height,w.drawImage(g,0,0,a.value.width,a.value.height)}p.fillStyle="rgba(0, 0, 0, 0.8)",p.fillRect(0,0,l.value.width,l.value.height),p.globalCompositeOperation="destination-out",t.externalRevealAreas.forEach(g=>{p.clearRect(g.x*_,g.y*_,g.width*_,g.height*_)}),p.globalCompositeOperation="source-over",m.value.forEach(g=>{p.fillStyle="rgba(0, 0, 0, 0.5)",p.fillRect(g.x*_,g.y*_,g.width*_,g.height*_),p.strokeStyle=g===i.value?"red":"#FFF",p.strokeRect(g.x*_,g.y*_,g.width*_,g.height*_)})},G=(p,g,z)=>z?p>=z.x&&p<=z.x+z.width&&g>=z.y&&g<=z.y+z.height:t.externalRevealAreas.some(M=>p>=M.x&&p<=M.x+M.width&&g>=M.y&&g<=M.y+M.height),Q=p=>{const g=l.value.getBoundingClientRect(),z=(p.clientX-g.left)/_,M=(p.clientY-g.top)/_;if(G(z,M)&&(y.value=!1,s.value=!1,i.value=null,O=t.externalRevealAreas.find(w=>z>=w.x&&z<=w.x+w.width&&M>=w.y&&M<=w.y+w.height),console.log("currentArea",O),m.value.forEach(w=>{z>=w.x&&z<=w.x+w.width&&M>=w.y&&M<=w.y+w.height&&(c.value=z-w.x,k.value=M-w.y,i.value=w,h.value=w,console.log("activeArea",i.value),z>w.x+w.width-10||z<w.x+10||M>w.y+w.height-10||M<w.y+10?(s.value=!0,u.value=H(z,M,w)):y.value=!0)}),!i.value)){const w={x:z,y:M,width:0,height:0,parentArea:O};m.value.push(w),i.value=w,s.value=!0,u.value="bottom-right"}},H=(p,g,z)=>{const M=Math.abs(p-z.x)<10,w=Math.abs(p-(z.x+z.width))<10,E=Math.abs(g-z.y)<10,de=Math.abs(g-(z.y+z.height))<10;return M&&E?"top-left":w&&E?"top-right":M&&de?"bottom-left":w&&de?"bottom-right":M?"left":w?"right":E?"top":de?"bottom":""},ve=p=>{const g=l.value.getBoundingClientRect(),z=(p.clientX-g.left)/_,M=(p.clientY-g.top)/_;if(G(z,M,O))l.value.style.cursor="move";else{l.value.style.cursor="not-allowed";return}if(y.value){const w=i.value.parentArea.x+i.value.parentArea.width-i.value.width,E=i.value.parentArea.y+i.value.parentArea.height-i.value.height,de=Math.min(Math.max(i.value.parentArea.x,z-c.value),w),oe=Math.min(Math.max(i.value.parentArea.y,M-k.value),E);i.value.x=de,i.value.y=oe,te()}else s.value?(W(z,M),te()):Y(z,M)},W=(p,g)=>{switch(u.value){case"top-left":R(g),A(p);break;case"top-right":R(g),B(p);break;case"bottom-left":F(g),A(p);break;case"bottom-right":F(g),B(p);break;case"left":A(p);break;case"right":B(p);break;case"top":R(g);break;case"bottom":F(g);break}},R=p=>{const g=i.value.height;i.value.height+=i.value.y-p,i.value.y=p,i.value.height<10&&(i.value.y-=10-g,i.value.height=10)},F=p=>{const g=Math.max(p,i.value.y+10);i.value.height=g-i.value.y},A=p=>{const g=i.value.width;i.value.width+=i.value.x-p,i.value.x=p,i.value.width<10&&(i.value.x-=10-g,i.value.width=10)},B=p=>{const g=Math.max(p,i.value.x+10);i.value.width=g-i.value.x},Y=(p,g)=>{if(!G(p,g)){l.value.style.cursor="not-allowed";return}let z="default";m.value.forEach(M=>{if(p>=M.x&&p<=M.x+M.width&&g>=M.y&&g<=M.y+M.height){const w=Math.abs(p-M.x)<10,E=Math.abs(p-(M.x+M.width))<10,de=Math.abs(g-M.y)<10,oe=Math.abs(g-(M.y+M.height))<10;de&&w?z="nw-resize":de&&E?z="ne-resize":oe&&w?z="sw-resize":oe&&E?z="se-resize":de?z="n-resize":oe?z="s-resize":w?z="w-resize":E?z="e-resize":z="move"}}),l.value.style.cursor=z},xe=()=>{m.value=m.value.filter(p=>p.width>15&&p.height>15),i.value&&!m.value.includes(i.value)&&(i.value=h.value),y.value=!1,s.value=!1,O=null,l.value.style.cursor="default",n.value.focus(),te()},ze=()=>{m.value=m.value.filter(p=>p.width>15&&p.height>15),y.value=!1,s.value=!1,l.value.style.cursor="default",te()};return e({drawCanvas:te,getAreas:()=>{const p=m.value.find(g=>!g.range||g.range.length===0);return console.log("errorArea",p),p?(i.value=p,n.value.focus(),h.value=p,te(),le.error("请填写奖符数据！"),!1):m.value}}),(p,g)=>{var de;const z=J("el-input"),M=J("el-tooltip"),w=J("el-tag"),E=J("el-button");return U(),N("div",al,[S("div",{class:"reveal-area-editor",ref_key:"editorRef",ref:v,onContextmenu:g[1]||(g[1]=be(oe=>Z(oe),["prevent"]))},[S("canvas",{ref_key:"bgCanvasRef",ref:a},null,512),S("canvas",{ref_key:"canvasRef",ref:l,onMousedown:Q,onMousemove:ve,onMouseup:xe,onMouseleave:ze},null,544),S("div",{class:Ge(["pa-input",T.value])},[S("span",{class:"iconfont icon-close",onClick:L}),ol,r(M,{class:"box-item",effect:"dark",content:"输入数据后，按【回车】按键添加",placement:"right"},{default:x(()=>[r(z,{ref_key:"inputRef",ref:n,placeholder:"请输入奖符数据",modelValue:f.value,"onUpdate:modelValue":g[0]||(g[0]=oe=>f.value=oe),onKeydown:V},null,8,["modelValue"])]),_:1}),nl,S("div",il,[(U(!0),N(re,null,he((de=i.value)==null?void 0:de.range,(oe,fe)=>(U(),se(w,{type:"primary",key:fe,onClose:Ul=>P(fe),closable:""},{default:x(()=>[K(me(oe),1)]),_:2},1032,["onClose"]))),128))])],2),d.value?(U(),N("ul",{key:0,class:"context-menu",style:Fe({top:`${I.value.y}px`,left:`${I.value.x}px`})},[S("li",{onClick:b},"复制"),S("li",{onClick:$},"删除")],4)):ae("",!0)],544),S("div",sl,[r(E,{onClick:g[2]||(g[2]=oe=>q(1))},{default:x(()=>[K("自动100%填充")]),_:1}),r(E,{onClick:g[3]||(g[3]=oe=>q(.5,"vertical"))},{default:x(()=>[K("垂直1/2填充")]),_:1}),r(E,{onClick:g[4]||(g[4]=oe=>q(.5,"horizontal"))},{default:x(()=>[K("水平1/2填充")]),_:1}),r(E,{onClick:ee,type:"danger",plain:""},{default:x(()=>[K("清空")]),_:1})])])}}},dl=ce(ul,[["__scopeId","data-v-a07a8a1d"]]),rl={class:"x-input-upload"},cl=["disabled"],Qe={__name:"XInputUpload",props:Ae({disabled:{type:Boolean,default:!1}},{image:{},imageModifiers:{},size:{},sizeModifiers:{}}),emits:Ae(["changeImage"],["update:image","update:size"]),setup(o,{emit:e}){const t=o;console.log(t.disabled),ie(()=>t.disabled,s=>{console.log(s)});const l=e,a=j(o,"image"),v=j(o,"size"),n=ge("commonClass");console.log(a.value);const m=C(null),h=C({imageSelected:!1,imageName:""}),i=s=>{const u=s.target.files;if(u&&u.length>0){const c=u[0];if(c){const k=new FileReader;k.onload=function(d){const I=new Image;I.onload=function(){v.value={width:I.width,height:I.height},console.log(v)},I.src=d.target.result},k.readAsDataURL(c)}n.uploadImages(c).then(k=>{h.imageSelected=!0,h.imageName=k.data,a.value=k.data,l("changeImage")}).catch(k=>{console.log(k),le.error(k)})}},y=()=>{m.value.click()};return(s,u)=>{const c=J("el-button"),k=J("el-input");return U(),N("div",rl,[a.value?ae("",!0):(U(),se(c,{key:0,class:"xbutton",disabled:o.disabled,type:"primary",onClick:y},{default:x(()=>[K(" 上传图片 ")]),_:1},8,["disabled"])),a.value?(U(),se(k,{key:1,placeholder:"请选择图片",modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=d=>a.value=d),readonly:""},{append:x(()=>[r(c,{disabled:o.disabled,type:"primary",link:"",onClick:y},{default:x(()=>[K("修改")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])):ae("",!0),S("input",{disabled:o.disabled,type:"file",ref_key:"inputRef",ref:m,onChange:u[1]||(u[1]=d=>i(d)),style:{display:"none"}},null,40,cl)])}}},hl={class:"ad-card-header"},vl={class:"ad-card-info"},ml={class:"row"},pl={__name:"AdCard",props:{initData:{},initDataModifiers:{},smallCard:{},smallCardModifiers:{}},emits:["update:initData","update:smallCard"],setup(o){const e=j(o,"initData"),t=j(o,"smallCard");console.log("adcard",e.value);const l=C(null),a=C(null),v=C(1),n=C(""),m=C(null),h=C(null),i=C(!1),y=C(!1),s=C(-1),u=[{text:"有",value:"openable"},{text:"无",value:"non-openable"}],c=[{text:"下左",value:"BL"},{text:"下中",value:"BC"},{text:"下右",value:"BR"}],k=[{text:"上",value:"T"},{text:"下",value:"B"},{text:"左",value:"L"},{text:"右",value:"R"}],d=C([]),I=()=>{e.value&&(d.value=e.value.map(b=>({type:b.type,imageSelected:!!b.image,imageFile:new File([],""),imageName:b.image,imageSize:b.imageSize,revealAreas:b.openRegions,adCardSize:b.adCardSize,adBoxCode:b.adBoxCode,adBoxCodePosition:b.adBoxCodePosition||"BL",comment:b.comment,openDirection:b.openDirection||"T"})),console.log("componentData",d.value))},f=b=>{b.adCardSize=T(t.value.box,b.imageSize)},T=(b,$)=>{if(console.log("findMaxRectBWithRatio",b,$),!$||!b||!$.width||!$.height||!b.width||!b.height||!b.thickness)return!1;const q=[456,310];let ee=[b.width,b.height,b.thickness];ee.sort(function(H,ve){return ve-H}),b=[ee[0],ee[1]];let ue,te;$.width>$.height?(ue=$.height,te=$.width):(ue=$.width,te=$.height);const G=ue/te;b.sort((H,ve)=>H-ve);let Q=[...q].sort((H,ve)=>H-ve);return Q[0]=Math.min(Q[0],Q[1]*G),Q[1]=Math.min(Q[1],Q[0]/G),(Q[0]>b[0]||Q[1]>b[1])&&(Q[0]=Math.min(b[0],Q[1]*G),Q[1]=Math.min(b[1],Q[0]/G)),Q=Q.map(H=>Math.floor(H)),console.log("maxRectB",Q),Q};ye(()=>{I()}),ie(e,(b,$)=>{console.log("initData",b,$),JSON.stringify(b)!==JSON.stringify($)&&I()}),ie(t,(b,$)=>{console.log(d.value),d.value.forEach(q=>{q.adCardSize=T(t.value.box,q.imageSize)})},{deep:!0}),ie(v,(b,$)=>{const q=b-$;if(q>0)for(let ee=0;ee<q;ee++)d.value.push({type:"non-openable",imageSelected:!1,imageName:0,imageFile:new File([],""),imageSize:"",revealAreas:[],prizeAreas:[],adBoxCode:"",adBoxCodePosition:"BL",openDirection:"T",comment:""});else q<0&&d.value.splice(b,Math.abs(q))}),ie(d,async(b,$)=>{console.log("componentData",b);let q=b.map(ee=>({type:ee.type,name:"Ad Card",adCardSize:ee.adCardSize,image:ee.imageName,imageSize:ee.imageSize,comment:ee.comment,openRegions:ee.revealAreas,adBoxCode:ee.adBoxCode,adBoxCodePosition:ee.adBoxCodePosition,openDirection:ee.openDirection}));e.value=q},{deep:!0});const O=b=>!d.value[b]||!d.value[b].revealAreas?0:d.value[b].revealAreas.length,D=b=>!d.value[b]||!d.value[b].prizeAreas?0:d.value[b].prizeAreas.length,_=b=>{s.value=b,i.value=!0,n.value=d.value[b].imageName,m.value=d.value[b].imageSize,h.value=d.value[b].adCardSize,console.log("addRevealArea",m,h)},L=async()=>{console.log("confirmRevealArea");let b=l.value.getAreas();b.length!=0&&(console.log(b),d.value[s.value].revealAreas=b,i.value=!1)},V=()=>{console.log(d.value[s.value]),i.value=!1},P=()=>{console.log(a.value);let b=a.value.getAreas();b&&(d.value[s.value].prizeAreas=b,y.value=!1)},Z=()=>{y.value=!1};return(b,$)=>{const q=J("el-input-number"),ee=J("el-input"),ue=J("el-button"),te=J("el-dialog");return U(),se(we,{title:"宣传卡信息"},{default:x(()=>[S("div",hl,[r(X,{label:"宣传卡数量",padding:"0 0 18px 0"},{default:x(()=>[r(q,{modelValue:v.value,"onUpdate:modelValue":$[0]||($[0]=G=>v.value=G),min:1,max:10},null,8,["modelValue"])]),_:1})]),(U(!0),N(re,null,he(d.value,(G,Q)=>(U(),N("div",{class:"ad-card-list",key:Q},[r(X,{label:"宣传卡"+(Q+1)+"有无揭开口",padding:"0 0 10px 0"},{default:x(()=>[r(pe,{DataList:u,modelValue:G.type,"onUpdate:modelValue":H=>G.type=H,type:"radio"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),r(X,{label:"卡号位置"},{default:x(()=>[r(pe,{DataList:c,modelValue:G.adBoxCodePosition,"onUpdate:modelValue":H=>G.adBoxCodePosition=H,type:"radio"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(X,{label:"揭开口方向",padding:"0 0 10px 0"},{default:x(()=>[r(pe,{modelValue:G.openDirection,"onUpdate:modelValue":H=>G.openDirection=H,DataList:k,type:"radio"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),S("div",vl,[S("div",ml,[r(X,{label:"宣传卡卡号",width:"220px"},{default:x(()=>[r(ee,{modelValue:G.adBoxCode,"onUpdate:modelValue":H=>G.adBoxCode=H,placeholder:"请输入名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(X,{label:"背景图",width:"220px"},{default:x(()=>[r(Qe,{disabled:O(Q)>0,size:G.imageSize,"onUpdate:size":H=>G.imageSize=H,image:G.imageName,"onUpdate:image":H=>G.imageName=H,onChangeImage:H=>f(G)},null,8,["disabled","size","onUpdate:size","image","onUpdate:image","onChangeImage"])]),_:2},1024),r(X,{label:"宣传卡尺寸(mm)",width:"220px"},{default:x(()=>[r(ee,{value:G.adCardSize,disabled:""},null,8,["value"])]),_:2},1024),r(X,{label:"揭开区",width:"220px",hide:G.type!="openable"},{default:x(()=>[O(Q)==0?(U(),se(ue,{key:0,class:"xbutton",type:"primary",disabled:!G.imageName,onClick:H=>_(Q)},{default:x(()=>[K(" 添加揭开区 ")]),_:2},1032,["disabled","onClick"])):ae("",!0),O(Q)>0?(U(),se(ee,{key:1,placeholder:"请添加揭开区",value:O(Q),readonly:"",disabled:D(Q)>0},{append:x(()=>[r(ue,{disabled:D(Q)>0,type:"primary",link:"",onClick:H=>_(Q)},{default:x(()=>[K("修改")]),_:2},1032,["disabled","onClick"])]),_:2},1032,["value","disabled"])):ae("",!0)]),_:2},1032,["hide"])]),r(X,{label:"备注",width:"100%"},{default:x(()=>[r(ee,{modelValue:G.comment,"onUpdate:modelValue":H=>G.comment=H,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]))),128)),r(te,{modelValue:i.value,"onUpdate:modelValue":$[1]||($[1]=G=>i.value=G),"destroy-on-close":!0,title:"添加揭开区","close-on-click-modal":!1,"close-on-press-escape":!1,fullscreen:!0},{footer:x(()=>[r(ue,{onClick:V},{default:x(()=>[K("取消")]),_:1}),r(ue,{type:"primary",onClick:L},{default:x(()=>[K("确定")]),_:1})]),default:x(()=>[r(ll,{ref_key:"RAEditor",ref:l,"ad-card-size":h.value,"pre-areas":d.value[s.value].revealAreas,"background-image-url":n.value,"image-size":m.value},null,8,["ad-card-size","pre-areas","background-image-url","image-size"])]),_:1},8,["modelValue"]),r(te,{modelValue:y.value,"onUpdate:modelValue":$[2]||($[2]=G=>y.value=G),width:"1000px","destroy-on-close":!0,title:"添加奖符区","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:x(()=>[r(ue,{onClick:Z},{default:x(()=>[K("取消")]),_:1}),r(ue,{type:"primary",onClick:P},{default:x(()=>[K("确定")]),_:1})]),default:x(()=>[r(dl,{ref_key:"PAEditor",ref:a,"pre-areas":d.value[s.value].prizeAreas,externalRevealAreas:d.value[s.value].revealAreas,"background-image-url":n.value},null,8,["pre-areas","externalRevealAreas","background-image-url"])]),_:1},8,["modelValue"])]),_:1})}}},gl=ce(pl,[["__scopeId","data-v-f3583318"]]),fl={class:"award-id"},yl={class:"addtype"},xl={class:"actions"},wl={class:"award-list"},bl={class:"item-type"},Al={class:"item-title"},Cl=["onClick"],kl={class:"item-input"},_l={class:"item-input"},Ml={key:0,class:"split-line"},Vl={__name:"PrizeMark",props:{initData:{},initDataModifiers:{}},emits:["update:initData"],setup(o){const e=j(o,"initData"),t=ge("commonClass");console.log("奖符",e.value);const l=C({}),a=C(!1),v=Je([{text:"现金奖",value:"cash",qty:0},{text:"不中奖",value:"noPrize",qty:0},{text:"HOLD卡",value:"holdCard",qty:0},{text:"自定义玩法",value:"custom",qty:0}]),n=f=>(console.log(e.value.filter(T=>T.type===f)),e.value.filter(T=>T.type===f)),m=f=>{_e.confirm("确定删除该奖符信息？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.value=e.value.filter(T=>T.id!==f.id)}).catch(()=>{console.log("取消删除")})},h=(f,T)=>{const O={id:Me(),type:f.value,name:"",imageSelected:!1,imageName:"",image:T||"",amount:"",count:"",total:"",comment:""};e.value||(e.value=[]),e.value.push(O)},i=f=>{f.amount=f.amount.replace(/[^\d.]/g,""),f.type!=="noPrize"&&s(f)},y=f=>{f.count=f.count.replace(/[^\d]/g,""),f.type!=="noPrize"&&s(f)},s=f=>{const T=parseFloat(f.amount)||0,O=parseInt(f.count)||0;f.total=(T*O).toString()},u=()=>{e.value=[],l.value={}},c=()=>{a.value=!1},k=()=>{a.value=!1,v.forEach(f=>{if(f.qty>0)for(let T=0;T<f.qty;T++)h(f)})},d=()=>{a.value=!0,v.forEach(f=>{f.qty=0})},I=async f=>{const T=document.createElement("input");T.type="file",T.multiple=!0,T.onchange=async O=>{const D=Array.from(O.target.files);D.sort((_,L)=>_.name.localeCompare(L.name));for(const _ of D)try{const L=await t.uploadImages(_);h(f,L.data)}catch(L){console.error(L),ElMessage.error(L)}},T.click()};return ye(()=>{e.value.forEach(f=>{f.id||(f.id=Me()),s(f)}),console.log(e.value)}),(f,T)=>{const O=J("el-button"),D=J("el-input"),_=J("el-input-number"),L=J("el-dialog");return U(),se(we,{title:"奖符"},{default:x(()=>[r(we,{title:"中奖标识种类",titleStyle:{"font-size":"14px",color:"#484848"},cardStyle:{padding:"0",background:"none","box-shadow":"none"}},{default:x(()=>[S("div",fl,[S("div",yl,[(U(!0),N(re,null,he(v,V=>(U(),se(O,{color:"#4d65b8",onClick:P=>I(V),key:V.value},{default:x(()=>[K("+"+me(V.text),1)]),_:2},1032,["onClick"]))),128))]),S("div",xl,[r(O,{color:"#4d65b8",onClick:d},{default:x(()=>[K("批量添加")]),_:1}),r(O,{type:"danger",onClick:u},{default:x(()=>[K("清空")]),_:1})])]),S("div",wl,[(U(!0),N(re,null,he(v,(V,P)=>(U(),N("div",{class:"award-item",key:P},[S("div",bl,[S("span",null,me(V.text),1)]),(U(!0),N(re,null,he(n(V.value),(Z,b)=>(U(),N("div",{class:"item-content",key:Z.id},[S("div",Al,[S("span",null,me(V.text)+me(b+1),1),S("span",{onClick:$=>m(Z),class:"iconfont icon-ashbin"},null,8,Cl)]),S("div",kl,[r(X,{label:"名称",width:"220px"},{default:x(()=>[r(D,{placeholder:"请输入名称",modelValue:Z.name,"onUpdate:modelValue":$=>Z.name=$},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(X,{label:"背景图",width:"220px"},{default:x(()=>[r(Qe,{image:Z.image,"onUpdate:image":$=>Z.image=$},null,8,["image","onUpdate:image"])]),_:2},1024),r(X,{label:"金额",width:"220px"},{default:x(()=>[r(D,{placeholder:"请输入金额",modelValue:Z.amount,"onUpdate:modelValue":$=>Z.amount=$,onInput:$=>i(Z),disabled:Z.type==="noPrize"},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"])]),_:2},1024),r(X,{label:"数量",width:"220px"},{default:x(()=>[r(D,{placeholder:"请输入数量",modelValue:Z.count,"onUpdate:modelValue":$=>Z.count=$,onInput:$=>y(Z),disabled:Z.type==="noPrize"},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"])]),_:2},1024),r(X,{label:"合计",width:"220px"},{default:x(()=>[r(D,{placeholder:"",modelValue:Z.total,"onUpdate:modelValue":$=>Z.total=$,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),S("div",_l,[r(X,{label:"备注",width:"100%"},{default:x(()=>[r(D,{placeholder:"请输入备注",modelValue:Z.comment,"onUpdate:modelValue":$=>Z.comment=$},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),b+1!=n(V.value).length?(U(),N("div",Ml)):ae("",!0)]))),128))]))),128))])]),_:1}),r(L,{modelValue:a.value,"onUpdate:modelValue":T[0]||(T[0]=V=>a.value=V),width:"350px","destroy-on-close":!0,title:"批量添加","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:x(()=>[r(O,{onClick:c},{default:x(()=>[K("取消")]),_:1}),r(O,{type:"primary",onClick:k},{default:x(()=>[K("确定")]),_:1})]),default:x(()=>[(U(!0),N(re,null,he(v,V=>(U(),N("div",{class:"batch-add",key:V.value},[r(X,{label:"奖符种类",width:"45%"},{default:x(()=>[r(D,{modelValue:V.text,"onUpdate:modelValue":P=>V.text=P,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),r(X,{label:"数量",width:"45%"},{default:x(()=>[r(_,{modelValue:V.qty,"onUpdate:modelValue":P=>V.qty=P,min:0,max:100,width:"100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]))),128))]),_:1},8,["modelValue"])]),_:1})}}};class Dl{constructor(e){this.apiService=new Ze,this.orderId=e}uploadImages(e,t=["image"]){let l=new FormData;return console.log(l),l.append("image",e),l.append("orderId",this.orderId),this.apiService.post("/ossFile/uploadImage",l,!0)}}const Rl={class:"create-order"},zl={__name:"CreateOrderView",setup(o){const e=C(""),t=et(),l=tt(),a=new ot,v=new Dl(e.value);Ne("commonClass",v);const n=C({name:"",translatedName:"",client:{clientName:""},sales:{employeeName:""},currency:"USD"}),m=C({size:{width:48,height:76},openQuantity:1,price:"",boxCount:1,smallBoxCodePosition:"BL",openDirection:"T",quantityPerBox:1,frontImage:"",backImage:"",box:{thickness:0,height:0,width:0}}),h=C([{type:"non-openable",name:"",image:"",comment:"",openRegions:[]}]),i=C({type:"image",image:"",titleInfo:{type:"text",image:""},games:[]}),y=C([]),s=C(!1),u=lt(()=>h.value.some(k=>k.openRegions.length>0));ye(()=>{l.query.id?a.getOrderById(l.query.id).then(k=>{console.log(k);let d=k.data.json;n.value=d.general,m.value=d.smallCard,h.value=d.adCard,i.value=d.payout,y.value=d.prizeMark,s.value=!0,e.value=d.orderId}):e.value=Me()});const c=()=>{if(n.value.name==""){le.error("请填写名字");return}if(n.value.translatedName==""){le.error("请填写翻译名字");return}if(n.value.client.clientName==""){le.error("请填写客户名");return}if(n.value.sales.employeeName==""){le.error("请填写业务员");return}if(m.value.price==""){le.error("请填写小卡价格");return}if(m.value.frontImage==""){le.error("请上传小卡正面图片");return}if(m.value.backImage==""){le.error("请上传小卡背面图片");return}if(h.value.length==0){le.error("请填写宣传卡信息");return}if(h.value.find(f=>{if(f.type==="openable"){if(!f.image)return le.error("请上传宣传卡图片"),!0;if(!f.openRegions.length)return le.error("请添加揭开区域"),!0}return!1})||y.value.find(f=>f.image?f.type==="noPrize"?!1:f.amount?f.count?!1:(le.error("请填写奖符数量"),!0):(le.error("请填写奖符金额"),!0):(le.error("请上传奖符图片"),!0)))return;let I={orderId:e.value,companyName:"Dongguan Huivo Data Technology Co.,Ltd.",general:n.value,smallCard:m.value,adCard:h.value,payout:i.value,prizeMark:y.value,status:s.value?"1":"0"};console.log(I),a.createOrder(I).then(f=>{console.log(f),_e.alert(f.msg,"提交结果",{confirmButtonText:"OK",callback:T=>{T=="confirm"&&t.push("/opencard")}})})};return(k,d)=>(U(),N("div",Rl,[r(st,{initData:n.value,"onUpdate:initData":d[0]||(d[0]=I=>n.value=I)},null,8,["initData"]),r(At,{hasOpenRegion:u.value,initData:m.value,"onUpdate:initData":d[1]||(d[1]=I=>m.value=I)},null,8,["hasOpenRegion","initData"]),r(gl,{initData:h.value,"onUpdate:initData":d[2]||(d[2]=I=>h.value=I),smallCard:m.value,"onUpdate:smallCard":d[3]||(d[3]=I=>m.value=I)},null,8,["initData","smallCard"]),ae("",!0),r(Vl,{initData:y.value,"onUpdate:initData":d[6]||(d[6]=I=>y.value=I),class:"prize-mark"},null,8,["initData"]),r(at,{onSubmit:c})]))}},Ll=ce(zl,[["__scopeId","data-v-60e86d70"]]);export{Ll as default};
