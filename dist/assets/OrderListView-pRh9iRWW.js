import{_ as ae,u as te,a as le,r as d,H as oe,i as se,o as ne,j as n,c as p,k as F,l as s,E as I,e as i,m as l,d as $,x as re,F as de,z as m,s as q,g as _,L as ue,q as M,y as E,p as ie,f as ce}from"./index-Cc1BFxfY.js";import{a as pe,X as g}from"./XComponent-DjQYbzDx.js";import{S as me,h as _e}from"./SearchService-D2tNcNLW.js";import{O as ge}from"./OpenCardService-DkowdGNi.js";const fe=f=>(ie("data-v-cb6b710a"),f=f(),ce(),f),ve={class:"general-content"},be={class:"number-range-container"},he={class:"number-range"},Se=fe(()=>i("div",{class:"to"},[i("span",null,"-")],-1)),Ce={key:0,class:"error-message"},ye={style:{display:"flex","align-items":"center"}},we={key:0,class:"pager"},ke={__name:"OrderListView",setup(f){const C=te(),y=le(),U=d([]),w=d(0),v=d(""),H=d(""),L=new ge,X=new me,o=oe({chineseName:"",customerName:"",smallCardSize:"",minTotal:null,maxTotal:null}),P=d(null),b=d(""),h=d(""),k=d(1),T=d(12),V=d({});se(o,e=>{if(o.minTotal!==null&&o.maxTotal!==null&&o.maxTotal<o.minTotal){v.value="最大值不能小于最小值";return}v.value="";for(const a in e)(e[a]===""||e[a]===null)&&delete e[a];Y({...e,startTime:b.value,endTime:h.value})});const j=e=>{if(e){const a=e.map(u=>{const N=u.getFullYear(),z=String(u.getMonth()+1).padStart(2,"0"),S=String(u.getDate()).padStart(2,"0"),x=String(u.getHours()).padStart(2,"0"),r=String(u.getMinutes()).padStart(2,"0"),O=String(u.getSeconds()).padStart(2,"0");return`${N}-${z}-${S} ${x}:${r}:${O}`});b.value=a[0],h.value=a[1]}else b.value="",h.value="";Y({...o,startTime:b.value,endTime:h.value})},Y=e=>{for(const a in e)(e[a]===""||e[a]===null)&&delete e[a];V.value=e,c()},R=()=>{C.push("/opencard/createorder")},J=e=>{localStorage.setItem("orderDetails",JSON.stringify(e)),C.push(`/opencard/orderlist/detail/${e.id}`)},c=async()=>{let e={pageSize:T.value,pageNum:k.value};V.value&&(e=Object.assign(e,V.value)),y.state.userInfo.id||await y.dispatch("getUserInfo"),e.nbUserId=y.state.userInfo.id,L.getList(e).then(a=>{U.value=a.data.orderList,w.value=a.data.totalPage}).catch(a=>{console.log(a),I.error(a)})},A=e=>{T.value=e,c()},G=e=>{k.value=e,c()};ne(()=>{X.getOptions().then(e=>{H.value=e.data}).catch(e=>{console.log(e)}),c()});const K=e=>{console.log(e),C.push({path:"/opencard/createorder",query:{id:e.id}})},Q=e=>{L.deleteOrder(e.id).then(a=>{I.success("删除成功"),c()}).catch(a=>{console.log(a),I.error(a)})};return(e,a)=>{const u=n("el-input"),N=n("el-option"),z=n("el-select"),S=n("el-input-number"),x=n("el-date-picker"),r=n("el-table-column"),O=n("el-tag"),B=n("el-button"),W=n("el-link"),Z=n("el-table"),ee=n("el-pagination");return p(),F(pe,{title:"订单管理",onCreateOrder:R},{default:s(()=>[i("div",ve,[l(g,{label:"产品名称"},{default:s(()=>[l(u,{modelValue:o.productName,"onUpdate:modelValue":a[0]||(a[0]=t=>o.productName=t),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"客户"},{default:s(()=>[l(u,{modelValue:o.customerName,"onUpdate:modelValue":a[1]||(a[1]=t=>o.customerName=t),placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"尺寸"},{default:s(()=>[l(z,{modelValue:o.smallCardSize,"onUpdate:modelValue":a[2]||(a[2]=t=>o.smallCardSize=t),placeholder:"请选择尺寸",clearable:""},{default:s(()=>[(p(!0),$(de,null,re(H.value.cardSizes,(t,D)=>(p(),F(N,{key:D,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"数量"},{default:s(()=>[i("div",be,[i("div",he,[l(S,{placeholder:"最小值",modelValue:o.minTotal,"onUpdate:modelValue":a[3]||(a[3]=t=>o.minTotal=t),controls:!1},null,8,["modelValue"]),Se,l(S,{placeholder:"最大值",modelValue:o.maxTotal,"onUpdate:modelValue":a[4]||(a[4]=t=>o.maxTotal=t),controls:!1},null,8,["modelValue"])]),v.value?(p(),$("div",Ce,m(v.value),1)):q("",!0)])]),_:1}),l(g,{label:"创建时间"},{default:s(()=>[l(x,{modelValue:P.value,"onUpdate:modelValue":a[5]||(a[5]=t=>P.value=t),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-value":[new Date,new Date],onChange:j},null,8,["modelValue","default-value"])]),_:1})]),l(Z,{data:U.value,style:{width:"100%"},onRowDblclick:J},{default:s(()=>[l(r,{prop:"productName",label:"产品名称","show-overflow-tooltip":!0},{default:s(t=>[_(m(t.row.productName)+"（"+m(t.row.chineseName)+"） ",1)]),_:1}),l(r,{prop:"customerName",label:"客户名字"}),l(r,{prop:"status",label:"状态"},{default:s(t=>[l(O,{type:["primary","warning","success","danger","danger"][t.row.status]},{default:s(()=>[_(m(["渲染中","待审核","已通过","未通过","渲染失败"][t.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"total",label:"数量"}),l(r,{prop:"smallCardSize",label:"尺寸"}),l(r,{prop:"businessPeople",label:"业务员"}),l(r,{prop:"createTime",label:"创建时间"},{default:s(t=>[i("div",ye,[i("span",null,m(ue(_e)(t.row.createTime).format("YYYY-MM-DD HH:mm:ss")),1)])]),_:1}),l(r,{fixed:"right",label:"操作"},{default:s(t=>[l(B,{link:"",type:"primary",size:"small",onClick:M(D=>K(t.row),["stop"]),class:E({"btn-disable":t.row.status==0}),disabled:t.row.status==0},{default:s(()=>[_(" 编辑 ")]),_:2},1032,["onClick","class","disabled"]),l(W,{type:"primary",href:t.row.pdfOss,onClick:a[6]||(a[6]=M(()=>{},["stop"])),class:E({"btn-disable":t.row.status==0||t.row.status==4}),disabled:t.row.status==0||t.row.status==4},{default:s(()=>[_(" 下载 ")]),_:2},1032,["href","class","disabled"]),l(B,{link:"",type:"danger",size:"small",onClick:M(D=>Q(t.row),["stop"])},{default:s(()=>[_(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),w.value?(p(),$("div",we,[l(ee,{onSizeChange:A,onCurrentChange:G,"current-page":k.value,"page-size":T.value,layout:"prev, pager, next",background:"","page-count":w.value},null,8,["current-page","page-size","page-count"])])):q("",!0)]),_:1})}}},xe=ae(ke,[["__scopeId","data-v-cb6b710a"]]);export{xe as default};
