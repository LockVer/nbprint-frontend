import{_ as te,u as ae,a as le,r as d,H as oe,i as se,o as ne,j as n,c as p,k as P,l as s,E as I,e as i,m as l,d as $,x as re,F as de,z as m,s as q,g as _,L as ue,q as M,y as E,p as ie,f as ce}from"./index-vR3Lhgap.js";import{a as pe,X as g}from"./XComponent-D69QkLrH.js";import{S as me,h as _e}from"./SearchService--JJp2xew.js";import{O as ge}from"./OpenCardService-B2Do_ils.js";const fe=f=>(ie("data-v-b7cb7174"),f=f(),ce(),f),ve={class:"general-content"},be={class:"number-range-container"},he={class:"number-range"},Se=fe(()=>i("div",{class:"to"},[i("span",null,"-")],-1)),ye={key:0,class:"error-message"},Ce={style:{display:"flex","align-items":"center"}},we={key:0,class:"pager"},ke={__name:"OrderListView",setup(f){const y=ae(),C=le(),U=d([]),w=d(0),v=d(""),H=d(""),L=new ge,X=new me,o=oe({chineseName:"",customerName:"",smallCardSize:"",minTotal:null,maxTotal:null}),Y=d(null),b=d(""),h=d(""),k=d(1),T=d(12),V=d({});se(o,e=>{if(o.minTotal!==null&&o.maxTotal!==null&&o.maxTotal<o.minTotal){v.value="最大值不能小于最小值";return}v.value="";for(const t in e)(e[t]===""||e[t]===null)&&delete e[t];B({...e,startTime:b.value,endTime:h.value})});const j=e=>{if(e){const t=e.map(u=>{const N=u.getFullYear(),x=String(u.getMonth()+1).padStart(2,"0"),S=String(u.getDate()).padStart(2,"0"),z=String(u.getHours()).padStart(2,"0"),r=String(u.getMinutes()).padStart(2,"0"),O=String(u.getSeconds()).padStart(2,"0");return`${N}-${x}-${S} ${z}:${r}:${O}`});b.value=t[0],h.value=t[1]}else b.value="",h.value="";B({...o,startTime:b.value,endTime:h.value})},B=e=>{for(const t in e)(e[t]===""||e[t]===null)&&delete e[t];V.value=e,c()},R=()=>{y.push("/opencard/createorder")},J=e=>{localStorage.setItem("orderDetails",JSON.stringify(e)),y.push(`/opencard/orderlist/detail/${e.id}`)},c=async()=>{let e={pageSize:T.value,pageNum:k.value};V.value&&(e=Object.assign(e,V.value)),C.state.userInfo.id||await C.dispatch("getUserInfo"),e.nbUserId=C.state.userInfo.id,L.getList(e).then(t=>{U.value=t.data.orderList,w.value=t.data.totalPage}).catch(t=>{console.log(t),I.error(t)})},A=e=>{T.value=e,c()},G=e=>{k.value=e,c()};ne(()=>{X.getOptions().then(e=>{H.value=e.data}).catch(e=>{console.log(e)}),c()});const K=e=>{console.log(e),y.push({path:"/opencard/createorder",query:{id:e.id}})},Q=e=>{L.deleteOrder(e.id).then(t=>{I.success("删除成功"),c()}).catch(t=>{console.log(t),I.error(t)})};return(e,t)=>{const u=n("el-input"),N=n("el-option"),x=n("el-select"),S=n("el-input-number"),z=n("el-date-picker"),r=n("el-table-column"),O=n("el-tag"),F=n("el-button"),W=n("el-link"),Z=n("el-table"),ee=n("el-pagination");return p(),P(pe,{title:"订单管理",onCreateOrder:R},{default:s(()=>[i("div",ve,[l(g,{label:"产品名称"},{default:s(()=>[l(u,{modelValue:o.productName,"onUpdate:modelValue":t[0]||(t[0]=a=>o.productName=a),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"客户"},{default:s(()=>[l(u,{modelValue:o.customerName,"onUpdate:modelValue":t[1]||(t[1]=a=>o.customerName=a),placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"尺寸"},{default:s(()=>[l(x,{modelValue:o.smallCardSize,"onUpdate:modelValue":t[2]||(t[2]=a=>o.smallCardSize=a),placeholder:"请选择尺寸",clearable:""},{default:s(()=>[(p(!0),$(de,null,re(H.value.cardSizes,(a,D)=>(p(),P(N,{key:D,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"数量"},{default:s(()=>[i("div",be,[i("div",he,[l(S,{placeholder:"最小值",modelValue:o.minTotal,"onUpdate:modelValue":t[3]||(t[3]=a=>o.minTotal=a),controls:!1},null,8,["modelValue"]),Se,l(S,{placeholder:"最大值",modelValue:o.maxTotal,"onUpdate:modelValue":t[4]||(t[4]=a=>o.maxTotal=a),controls:!1},null,8,["modelValue"])]),v.value?(p(),$("div",ye,m(v.value),1)):q("",!0)])]),_:1}),l(g,{label:"创建时间"},{default:s(()=>[l(z,{modelValue:Y.value,"onUpdate:modelValue":t[5]||(t[5]=a=>Y.value=a),type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-value":[new Date,new Date],onChange:j},null,8,["modelValue","default-value"])]),_:1})]),l(Z,{data:U.value,style:{width:"100%"},onRowDblclick:J},{default:s(()=>[l(r,{prop:"productName",label:"产品名称","show-overflow-tooltip":!0},{default:s(a=>[_(m(a.row.productName)+"（"+m(a.row.chineseName)+"） ",1)]),_:1}),l(r,{prop:"customerName",label:"客户名字"}),l(r,{prop:"status",label:"状态"},{default:s(a=>[l(O,{type:["primary","warning","success","danger","danger"][a.row.status]},{default:s(()=>[_(m(["渲染中","待审核","已通过","未通过","渲染失败"][a.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"total",label:"数量"}),l(r,{prop:"smallCardSize",label:"尺寸"}),l(r,{prop:"userName",label:"业务员"}),l(r,{prop:"createTime",label:"创建时间"},{default:s(a=>[i("div",Ce,[i("span",null,m(ue(_e)(a.row.createTime).format("YYYY-MM-DD HH:mm:ss")),1)])]),_:1}),l(r,{fixed:"right",label:"操作"},{default:s(a=>[l(F,{link:"",type:"primary",size:"small",onClick:M(D=>K(a.row),["stop"]),class:E({"btn-disable":a.row.status==0}),disabled:a.row.status==0},{default:s(()=>[_(" 编辑 ")]),_:2},1032,["onClick","class","disabled"]),l(W,{type:"primary",href:a.row.pdfOss,onClick:t[6]||(t[6]=M(()=>{},["stop"])),style:{padding:"2px"},class:E({"btn-disable":a.row.status==0||a.row.status==4}),disabled:a.row.status==0||a.row.status==4},{default:s(()=>[_(" 下载 ")]),_:2},1032,["href","class","disabled"]),l(F,{link:"",type:"danger",size:"small",onClick:M(D=>Q(a.row),["stop"])},{default:s(()=>[_(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),w.value?(p(),$("div",we,[l(ee,{onSizeChange:A,onCurrentChange:G,"current-page":k.value,"page-size":T.value,layout:"prev, pager, next",background:"","page-count":w.value},null,8,["current-page","page-size","page-count"])])):q("",!0)]),_:1})}}},ze=te(ke,[["__scopeId","data-v-b7cb7174"]]);export{ze as default};
